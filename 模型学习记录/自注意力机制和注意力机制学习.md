- 自注意力机制

  从内容的角度：假设D是输入序列的内容，完全忽略线性变换的话可以近似认为Q=K=V=D（所以叫做Self-Attention，因为这是输入的序列对它自己的注意力），于是序列中的每一个元素经过Self-Attention之后的表示就可以这样展现：

  ![img](D:%5C013_GitHubDesktopSetup_data%5CSharing-of-publicly-available-study-records-at-the-graduate-level%5C%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%5C%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%92%8C%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0.assets%5Cv2-8ed6506d0cb14e2d1cd96779c6e45d91_1440w.jpg)

  The这个词的表示，实际上是整个序列加权求和的结果——权重从哪来？点积之后Softmax得到——这里Softmax(QK)就是求权重的体现。我们知道，向量点积的值可以表征词与词之间的相似性，而此处的“整个序列”==包括The这个词自己（再一次强调这是Self-Attention）==，所以最后输出的词的表示，其“主要成分”就主要地包含它自身和跟它相似的词的表示，其他无关的词的表示对应的权重就会比较低。

  

  作者：到处挖坑蒋玉成
  链接：https://www.zhihu.com/question/298810062/answer/1833841976
  来源：知乎
  著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

  从向量的角度：

  ![image-20210628111308548](D:%5C013_GitHubDesktopSetup_data%5CSharing-of-publicly-available-study-records-at-the-graduate-level%5C%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%5C%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%92%8C%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0.assets%5Cimage-20210628111308548.png)

  Q(Querry)代表查询值，就是解码器的t-1状态

  K(Key)代表键，就是编码器的所有隐状态

  将QK计算相似度，用softmax之后得到带有注意力的权重（在翻译任务中KV 是一样的），有了这个权重之后，就可以用这个权重对Value进行加权求和，生成的这个新的向量就是带有注意力机制的语义向量 Context vector

  一个查字典的角度:

  ![image-20210628112422821](D:%5C013_GitHubDesktopSetup_data%5CSharing-of-publicly-available-study-records-at-the-graduate-level%5C%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%5C%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%92%8C%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0.assets%5Cimage-20210628112422821.png)

  一个买水果的例子：

  在理解attention的时候我想了一个买水果的例子。今天你要去水果摊买水果，首先你脑袋里会想出一个买水果的标准（个大、成色好、价格美丽等）作为 query，然后你就去各个水果摊逛了，水果摊主上来给你拿出水果一顿介绍（我这香甜可口，新鲜美味，性价比高）这就是 key，然后你会通过水果的情况 key 和自己心中标准 query 权衡给这个水果摊子打个分，当你一条水果街都走完了，你就对整条街的水果摊都有了一个性价比分数（atten），然后根据这个性价比分数就开始买了，这个水果摊好分数高，我买多点，那个水果摊性价比分数低不能满足我的需求我就少买点，最后我就从不同的水果摊采购了不同数量的水果（value）放进了自己的推推车里（output）

  

  作者：繁华里流浪
  链接：https://www.zhihu.com/question/298810062/answer/1336554776
  来源：知乎
  著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

  从数值的角度：

  V是一个值序列，序列中的每个值在一开始都看做是互相独立的，信息量有限。而想要让每个值包含更多的信息，一个办法就是让每个值去融合该序列中其他值的信息。融合方式中，最差的方法是取平均(mean pool)，会有大量实际不相关的信息被融入; 更好的方式是按照该值和其他值的相关度加权求和。

  那么问题来了，怎么看V中每一个值和其他值的相关度，并将相关度量化成权重数值(用于最终的加权求和)？

  这个时候，Q和K来了，Q是询问的值(对应到V中的某个值)，K是被询问的值序列，Q问K，你的哪个值跟我最像？Q挨个问一遍K中的值，每个值和Q比较后得到一个和Q的相似程度，组成一个相似度序列。

  相似度序列归一化后变成一个和为1序列，可以看成是一个权重。

  这个权重就是V序列中对应的那个值和其他值的相关度的权重量化。

  概括: Q查K以提供  给V中每个值和其他值之间加权求和  的权重。

  

  作者：Sail
  链接：https://www.zhihu.com/question/298810062/answer/1829118404
  来源：知乎
  著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

- 自注意力机制的分类

  

  ![img](D:%5C013_GitHubDesktopSetup_data%5CSharing-of-publicly-available-study-records-at-the-graduate-level%5C%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%5C%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%92%8C%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0.assets%5Cv2-f44d7bc6b8985379a4520acaf56d0eb0_1440w.jpg)

  ![image-20210628114943708](D:%5C013_GitHubDesktopSetup_data%5CSharing-of-publicly-available-study-records-at-the-graduate-level%5C%E6%A8%A1%E5%9E%8B%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%5C%E8%87%AA%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%92%8C%E6%B3%A8%E6%84%8F%E5%8A%9B%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0.assets%5Cimage-20210628114943708.png)

- 



